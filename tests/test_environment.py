import numpy as np

from AEIC.environment.temperature_response import deltaT_2box, deltaT_config


def test_2box_deltaT():
    # Unit test for 2box temperature response model using CO2 RF 2019
    RF_testing = np.array(
        [
            0.00154937,
            0.001447,
            0.00136368,
            0.00129551,
            0.00123936,
            0.00119277,
            0.00115381,
            0.00112093,
            0.0010929,
            0.00106878,
            0.00104777,
            0.00102929,
            0.00101286,
            0.00099808,
            0.00098465,
            0.00097235,
            0.00096096,
            0.00095035,
            0.00094039,
            0.00093098,
            0.00092204,
            0.00091352,
            0.00090535,
            0.00089751,
            0.00088995,
            0.00088265,
            0.00087558,
            0.00086874,
            0.0008621,
            0.00085564,
            0.00084937,
            0.00084326,
            0.00083732,
            0.00083153,
            0.00082588,
            0.00082038,
            0.00081501,
            0.00080977,
            0.00080466,
            0.00079967,
            0.0007948,
            0.00079004,
            0.00078539,
            0.00078086,
            0.00077642,
            0.00077209,
            0.00076786,
            0.00076372,
            0.00075968,
            0.00075573,
            0.00075187,
            0.00074809,
            0.0007444,
            0.00074079,
            0.00073726,
            0.0007338,
            0.00073042,
            0.00072712,
            0.00072388,
            0.00072072,
            0.00071762,
            0.00071459,
            0.00071162,
            0.00070871,
            0.00070586,
            0.00070308,
            0.00070035,
            0.00069767,
            0.00069505,
            0.00069249,
            0.00068997,
            0.00068751,
            0.00068509,
            0.00068272,
            0.0006804,
            0.00067812,
            0.00067589,
            0.0006737,
            0.00067155,
            0.00066944,
            0.00066738,
            0.00066535,
            0.00066335,
            0.0006614,
            0.00065948,
            0.00065759,
            0.00065574,
            0.00065392,
            0.00065213,
            0.00065038,
            0.00064865,
            0.00064696,
            0.00064529,
            0.00064365,
            0.00064204,
            0.00064045,
            0.00063889,
            0.00063736,
            0.00063585,
            0.00063436,
        ]
    )

    testdT1 = np.array(
        [
            0.0,
            0.00015604,
            0.0002729,
            0.00035977,
            0.00042374,
            0.00047028,
            0.00050358,
            0.00052687,
            0.00054262,
            0.00055272,
            0.0005586,
            0.00056136,
            0.00056184,
            0.00056067,
            0.0005583,
            0.00055512,
            0.00055136,
            0.00054725,
            0.00054291,
            0.00053845,
            0.00053395,
            0.00052947,
            0.00052504,
            0.00052069,
            0.00051644,
            0.00051228,
            0.00050824,
            0.00050432,
            0.00050051,
            0.00049681,
            0.00049322,
            0.00048973,
            0.00048635,
            0.00048307,
            0.00047989,
            0.0004768,
            0.00047379,
            0.00047088,
            0.00046804,
            0.00046529,
            0.00046261,
            0.00046,
            0.00045746,
            0.000455,
            0.0004526,
            0.00045026,
            0.00044798,
            0.00044577,
            0.00044361,
            0.00044151,
            0.00043946,
            0.00043747,
            0.00043553,
            0.00043363,
            0.00043179,
            0.00042999,
            0.00042824,
            0.00042654,
            0.00042487,
            0.00042325,
            0.00042167,
            0.00042013,
            0.00041863,
            0.00041716,
            0.00041573,
            0.00041434,
            0.00041298,
            0.00041166,
            0.00041036,
            0.0004091,
            0.00040787,
            0.00040668,
            0.00040551,
            0.00040436,
            0.00040325,
            0.00040216,
            0.0004011,
            0.00040007,
            0.00039906,
            0.00039807,
            0.00039711,
            0.00039617,
            0.00039525,
            0.00039436,
            0.00039348,
            0.00039263,
            0.0003918,
            0.00039098,
            0.00039019,
            0.00038941,
            0.00038865,
            0.00038791,
            0.00038719,
            0.00038648,
            0.00038579,
            0.00038511,
            0.00038445,
            0.00038381,
            0.00038317,
            0.00038256,
        ]
    )
    testdT2 = np.array(
        [
            0.00000000e00,
            0.00000000e00,
            2.86308581e-07,
            7.86507869e-07,
            1.44518275e-06,
            2.22003096e-06,
            3.07884848e-06,
            3.99719582e-06,
            4.95659320e-06,
            5.94312672e-06,
            6.94637303e-06,
            7.95857112e-06,
            8.97398530e-06,
            9.98841604e-06,
            1.09988251e-05,
            1.20030488e-05,
            1.29995790e-05,
            1.39873968e-05,
            1.49658457e-05,
            1.59345360e-05,
            1.68932726e-05,
            1.78420005e-05,
            1.87807646e-05,
            1.97096789e-05,
            2.06289048e-05,
            2.15386344e-05,
            2.24390785e-05,
            2.33304581e-05,
            2.42129984e-05,
            2.50869245e-05,
            2.59524583e-05,
            2.68098170e-05,
            2.76592117e-05,
            2.85008464e-05,
            2.93349185e-05,
            3.01616180e-05,
            3.09811278e-05,
            3.17936241e-05,
            3.25992765e-05,
            3.33982483e-05,
            3.41906970e-05,
            3.49767743e-05,
            3.57566268e-05,
            3.65303957e-05,
            3.72982180e-05,
            3.80602257e-05,
            3.88165469e-05,
            3.95673055e-05,
            4.03126216e-05,
            4.10526117e-05,
            4.17873888e-05,
            4.25170625e-05,
            4.32417394e-05,
            4.39615228e-05,
            4.46765132e-05,
            4.53868084e-05,
            4.60925031e-05,
            4.67936899e-05,
            4.74904584e-05,
            4.81828960e-05,
            4.88710877e-05,
            4.95551161e-05,
            5.02350618e-05,
            5.09110030e-05,
            5.15830160e-05,
            5.22511750e-05,
            5.29155522e-05,
            5.35762179e-05,
            5.42332406e-05,
            5.48866870e-05,
            5.55366221e-05,
            5.61831090e-05,
            5.68262094e-05,
            5.74659831e-05,
            5.81024887e-05,
            5.87357829e-05,
            5.93659213e-05,
            5.99929578e-05,
            6.06169451e-05,
            6.12379342e-05,
            6.18559751e-05,
            6.24711166e-05,
            6.30834058e-05,
            6.36928890e-05,
            6.42996112e-05,
            6.49036162e-05,
            6.55049467e-05,
            6.61036443e-05,
            6.66997496e-05,
            6.72933020e-05,
            6.78843403e-05,
            6.84729018e-05,
            6.90590232e-05,
            6.96427401e-05,
            7.02240874e-05,
            7.08030990e-05,
            7.13798080e-05,
            7.19542464e-05,
            7.25264459e-05,
            7.30964370e-05,
        ]
    )

    config = deltaT_config()

    assert config.C1 == 313346666.66429996
    assert config.C2 == 14700000000
    assert config.advective_mass == 0.0001435
    assert config.diffuse_coeff == 7e-05
    assert config.z == 1166.6667
    assert config.lambda_climate == 1.0178117048346056

    output = deltaT_2box(RF_testing, config)
    assert np.allclose(output.deltaT_surface, testdT1, rtol=1e-4)
    assert np.allclose(output.deltaT_deep, testdT2, rtol=1e-4)
